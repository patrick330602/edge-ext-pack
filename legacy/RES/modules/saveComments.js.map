{"version":3,"sources":["modules/saveComments.js"],"names":[],"mappings":"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","file":"modules/saveComments.js","sourcesContent":["addModule('saveComments', function(module, moduleID) {\r\n\tmodule.moduleName = 'Save Comments';\r\n\tmodule.category = 'Comments';\r\n\tmodule.exclude = [\r\n\t\t'submit'\r\n\t];\r\n\tmodule.loadDynamicOptions = function() {\r\n\t\tthis.description = '\\\r\n\t\t\tYou can save comments with RES: click the <em>save-RES</em> button below the comment. You can view \\\r\n\t\t\tthese comments on your user page under the \"saved - RES\" tab (reddit.com/user/MyUsername/saved#comments). \\\r\n\t\t\tIf you use ' + modules['settingsNavigation'].makeUrlHashLink('keyboardNav') + ', you can press ' + modules['keyboardNav'].getNiceKeyCode('toggleCmdLine') + ' \\\r\n\t\t\tto open the RES command line, then type in <code>me/sc</code> to see saved-RES comments. \\\r\n\t\t\t<br><br>\\\r\n\t\t\tSaving with RES saves a comment locally in your browser. This means that you can see the comment you saved \\\r\n\t\t\t<i>as it looked when you saved it</i>, even if it is later edited or deleted. \\\r\n\t\t\tYou can save comments with RES if you are not logged in, or if you are logged in to any account—all the \\\r\n\t\t\tcomments will be visible in one location. You will only be able to view saved RES comments on whichever browser\\\r\n\t\t\tyou have RES istalled on.\\\r\n\t\t\t<br><br>\t\\\r\n\t\t\tWhen saving comments with reddit, you must be logged into an account; the comment is saved specifically for that account;\\\r\n\t\t\tit won\\'t be shown if you switch to a different account or log out. You can view these comments whenever you are logged into\\\r\n\t\t\tthe reddit account you saved them from, including on other browsers or devices.  \\\r\n\t\t\t<br><br>\t\\\r\n\t\t\tVisually, saving comments with reddit looks the same as saving with RES—but the text is not saved locally,\\\r\n\t\t\tso the saved comment text shows the <i>current</i> state of the comment. If the comment has been edited or deleted \\\r\n\t\t\tsince you saved it, the text that displays on your account\\'s \"saved\" page will look different then it looked when you saved it.\\\r\n\t\t\t<br><br>\t\\\r\n\t\t\tIf you have <a href=\"/gold/about\">reddit gold</a> on an account, you can add a category/tag to comments you have saved \\\r\n\t\t\twith reddit, then filter saved comments/posts by category. (You cannot sort or filter comments saved with RES.) \\\r\n\t\t\t';\r\n\t};\r\n\r\n\tvar savedRe = /^https?:\\/\\/([a-z]+)\\.reddit\\.com\\/user\\/([\\-\\w]+)\\/saved\\/?/i;\r\n\r\n\tmodule.go = function() {\r\n\t\tif ((this.isEnabled()) && (this.isMatchURL())) {\r\n\t\t\tvar currURL = location.href;\r\n\t\t\tif (RESUtils.pageType() === 'comments') {\r\n\t\t\t\t// load already-saved comments into memory...\r\n\t\t\t\tloadSavedComments();\r\n\t\t\t\taddSaveLinks();\r\n\t\t\t\t$('body').on('click', 'li.saveComments', function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tvar $this = $(this);\r\n\t\t\t\t\tsaveComment(this, $this.data('saveID'), $this.data('saveLink'), $this.data('saveUser'));\r\n\t\t\t\t});\r\n\t\t\t\t$('body').on('click', 'li.unsaveComments', function(e) {\r\n\t\t\t\t\t// e.preventDefault();\r\n\t\t\t\t\tvar id = $(this).data('unsaveID');\r\n\t\t\t\t\tunsaveComment(id, this);\r\n\t\t\t\t});\r\n\t\t\t} else if (savedRe.test(currURL)) {\r\n\t\t\t\t// load already-saved comments into memory...\r\n\t\t\t\tloadSavedComments();\r\n\t\t\t\taddSavedCommentsTab();\r\n\t\t\t\tdrawSavedComments();\r\n\t\t\t\tif (location.hash === '#comments') {\r\n\t\t\t\t\tshowSavedTab('comments');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\taddSavedCommentsTab();\r\n\t\t\t}\r\n\t\t\tRESUtils.watchForElement('newComments', addSaveLinkToComment);\r\n\t\t}\r\n\t};\r\n\r\n\tfunction addSaveLinks(ele) {\r\n\t\tele = ele || document.body;\r\n\r\n\t\t// top: new-style. bottom: old-style.\r\n\t\tvar allComments = ele.querySelectorAll('div.commentarea > div.sitetable > div.thing div.entry, ' +\r\n\t\t\t'div.commentarea > div.sitetable > div.thing div.entry div.entry');\r\n\t\tRESUtils.forEachChunked(allComments, 15, 1000, function(comment, i, array) {\r\n\t\t\taddSaveLinkToComment(comment);\r\n\t\t});\r\n\t}\r\n\r\n\tvar storedComments = {};\r\n\r\n\tfunction addSaveLinkToComment(commentObj) {\r\n\t\tvar $commentObj = $(commentObj),\r\n\t\t\t$commentsUL = $commentObj.find('ul.flat-list'),\r\n\t\t\t$permaLink = $commentsUL.find('li.first a.bylink');\r\n\r\n\t\tif ($permaLink.length > 0) {\r\n\t\t\t// Insert the link right after Reddit Gold's \"save\" comment link\r\n\t\t\tvar $userLink = $commentObj.find('a.author'),\r\n\t\t\t\tsaveUser;\r\n\r\n\t\t\tif ($userLink.length === 0) {\r\n\t\t\t\tsaveUser = '[deleted]';\r\n\t\t\t} else {\r\n\t\t\t\tsaveUser = $userLink.text();\r\n\t\t\t}\r\n\r\n\t\t\tvar saveHref = $permaLink.attr('href'),\r\n\t\t\t\tsplitHref = saveHref.split('/'),\r\n\t\t\t\tsaveID = splitHref[splitHref.length - 1],\r\n\t\t\t\t$saveLink = $('<li>');\r\n\r\n\t\t\tif (storedComments && storedComments[saveID]) {\r\n\t\t\t\t$saveLink.html('<a class=\"RES-saved noCtrlF\" href=\"/saved#comments\" data-text=\"saved-RES\"></a>');\r\n\t\t\t} else {\r\n\t\t\t\t$saveLink.html('<a class=\"RES-save noCtrlF\" href=\"javascript:void 0\" title=\"Save using RES - which is local only, but preserves the full text in case someone edits/deletes it\" data-text=\"save-RES\"></a>')\r\n\t\t\t\t\t.addClass('saveComments')\r\n\t\t\t\t\t.data('saveID', saveID)\r\n\t\t\t\t\t.data('saveLink', saveHref)\r\n\t\t\t\t\t.data('saveUser', saveUser);\r\n\t\t\t}\r\n\r\n\t\t\tvar $whereToInsert = $commentsUL.find('.comment-save-button');\r\n\t\t\t$whereToInsert.after($saveLink);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction loadSavedComments() {\r\n\t\t// first, check if we're storing saved comments the old way (as an array)...\r\n\t\tvar thisComments = RESStorage.getItem('RESmodules.saveComments.savedComments');\r\n\t\tif (thisComments === null) {\r\n\t\t\tstoredComments = {};\r\n\t\t} else {\r\n\t\t\tstoredComments = safeJSON.parse(thisComments, 'RESmodules.saveComments.savedComments');\r\n\t\t\t// old way of storing saved comments... convert...\r\n\t\t\tif (thisComments.slice(0, 1) === '[') {\r\n\t\t\t\tvar newFormat = {};\r\n\t\t\t\tfor (var i in storedComments) {\r\n\t\t\t\t\tvar urlSplit = storedComments[i].href.split('/');\r\n\t\t\t\t\tvar thisID = urlSplit[urlSplit.length - 1];\r\n\t\t\t\t\tnewFormat[thisID] = storedComments[i];\r\n\t\t\t\t}\r\n\t\t\t\tstoredComments = newFormat;\r\n\t\t\t\tRESStorage.setItem('RESmodules.saveComments.savedComments', JSON.stringify(newFormat));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction saveComment(obj, id, href, username) {\r\n\t\t// reload saved comments in case they've been updated in other tabs (works in all but greasemonkey)\r\n\t\tloadSavedComments();\r\n\t\t// loop through comments and make sure we haven't already saved this one...\r\n\t\tif (storedComments[id]) {\r\n\t\t\talert('comment already saved!');\r\n\t\t} else {\r\n\t\t\tvar selectedThing = modules['selectedEntry'].unselect(); // un-munge annotations or other mutilations\r\n\r\n\t\t\tvar comment = obj.parentNode.parentNode.querySelector('div.usertext-body > div.md');\r\n\t\t\tif (comment !== null) {\r\n\t\t\t\tvar commentHTML = comment.innerHTML.replace(/<script(.|\\s)*?\\/script>/g, ''),\r\n\t\t\t\t\tsavedComment = {\r\n\t\t\t\t\t\thref: href,\r\n\t\t\t\t\t\tusername: username,\r\n\t\t\t\t\t\tcomment: commentHTML,\r\n\t\t\t\t\t\ttimeSaved: Date()\r\n\t\t\t\t\t};\r\n\t\t\t\tstoredComments[id] = savedComment;\r\n\r\n\t\t\t\tvar $unsaveObj = $('<li>');\r\n\t\t\t\t$unsaveObj.html('<a href=\"javascript:void 0\">unsave-RES</a>')\r\n\t\t\t\t\t.data('unsaveID', id)\r\n\t\t\t\t\t.data('unsaveLink', href)\r\n\t\t\t\t\t.addClass('unsaveComments');\r\n\r\n\t\t\t\t$(obj).replaceWith($unsaveObj);\r\n\t\t\t}\r\n\t\t\tmodules['selectedEntry'].select(selectedThing); // restore munging\r\n\t\t\tRESStorage.setItem('RESmodules.saveComments.savedComments', JSON.stringify(storedComments));\r\n\t\t}\r\n\t}\r\n\r\n\tfunction addSavedCommentsTab() {\r\n\t\tvar mainmenuUL = document.body.querySelector('#header-bottom-left ul.tabmenu');\r\n\t\tif (mainmenuUL) {\r\n\t\t\tvar menuItems = mainmenuUL.querySelectorAll('li');\r\n\t\t\tfor (var i = 0, len = menuItems.length; i < len; i++) {\r\n\t\t\t\tvar savedLink = menuItems[i].querySelector('a');\r\n\t\t\t\tif ((menuItems[i].classList.contains('selected')) && (savedRe.test(savedLink.getAttribute('href')))) {\r\n\t\t\t\t\tmenuItems[i].addEventListener('click', function(e) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\tshowSavedTab('links');\r\n\t\t\t\t\t}, true);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (savedRe.test(savedLink.getAttribute('href'))) {\r\n\t\t\t\t\t$(menuItems[i]).attr('id', 'savedLinksTab');\r\n\t\t\t\t\tsavedLink.textContent = 'saved - reddit';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$('<li id=\"savedCommentsTab\">')\r\n\t\t\t\t.html('<a href=\"javascript:void 0\">saved - RES</a>')\r\n\t\t\t\t.insertAfter('#savedLinksTab');\r\n\t\t\tif (savedRe.test(location.href)) {\r\n\t\t\t\t$('#savedCommentsTab').on('click', function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tshowSavedTab('comments');\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\t$('#savedCommentsTab').on('click', function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tlocation.href = location.protocol + '//www.reddit.com/saved/#comments';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tvar savedLinksContent, savedCommentsContent;\r\n\r\n\tfunction showSavedTab(tab) {\r\n\t\tswitch (tab) {\r\n\t\t\tcase 'links':\r\n\t\t\t\tlocation.hash = 'links';\r\n\t\t\t\tsavedLinksContent.style.display = 'block';\r\n\t\t\t\tsavedCommentsContent.style.display = 'none';\r\n\t\t\t\t$('#savedLinksTab').addClass('selected');\r\n\t\t\t\t$('#savedCommentsTab').removeClass('selected');\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'comments':\r\n\t\t\t\tlocation.hash = 'comments';\r\n\t\t\t\tsavedLinksContent.style.display = 'none';\r\n\t\t\t\tsavedCommentsContent.style.display = 'block';\r\n\t\t\t\t$('#savedLinksTab').removeClass('selected');\r\n\t\t\t\t$('#savedCommentsTab').addClass('selected');\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction drawSavedComments() {\r\n\t\tsavedLinksContent = document.body.querySelector('BODY > div.content');\r\n\t\tsavedCommentsContent = RESUtils.createElement('div', 'savedLinksList');\r\n\t\tsavedCommentsContent.style.display = 'none';\r\n\t\tsavedCommentsContent.setAttribute('class', 'sitetable linklisting');\r\n\r\n\t\tvar saveRESTips = document.createElement('div');\r\n\t\tsaveRESTips.classList.add('savedComment', 'entry');\r\n\t\t$(saveRESTips).safeHtml('<p><b>Tip:</b> Don\\'t see a comment here? Check the \"saved - reddit\" tab above.</p><p>Currently, the keyboard shortcut \"' + modules['keyboardNav'].getNiceKeyCode('savePost') + '\" saves a post to your reddit account, \"' + modules['keyboardNav'].getNiceKeyCode('saveComment') + '\" saves a comment to your reddit account, and \"' + modules['keyboardNav'].getNiceKeyCode('saveRES') + '\" saves a comment locally with RES. These can be changed in the ' + modules['settingsNavigation'].makeUrlHashLink('keyboardNav', 'savePost', 'settings console') + '.</p>');\r\n\t\tsavedCommentsContent.appendChild(saveRESTips);\r\n\r\n\t\tfor (var i in storedComments) {\r\n\t\t\tif ((i !== 'RESPro_add') && (i !== 'RESPro_delete')) {\r\n\t\t\t\tvar clearLeft = document.createElement('div');\r\n\t\t\t\tclearLeft.setAttribute('class', 'clearleft');\r\n\t\t\t\tvar thisComment = document.createElement('div');\r\n\t\t\t\tthisComment.classList.add('savedComment');\r\n\t\t\t\tthisComment.classList.add('entry');\r\n\t\t\t\t// this is all saved locally, but just for safety, we'll clean out any script tags and whatnot...\r\n\t\t\t\t// we'll also remove iframe / video tags because they might autoplay.\r\n\t\t\t\t// TODO: save comments using markdown instead of HTML in the future. It's cleaner/safer/better.\r\n\t\t\t\tvar cleanHTML = '<div class=\"savedCommentHeader\">Comment by user: ' + escapeHTML(storedComments[i].username) + ' saved on ' + escapeHTML(storedComments[i].timeSaved) + '</div>';\r\n\t\t\t\tcleanHTML += '<div class=\"savedCommentBody md\">' + storedComments[i].comment.replace(/<(script|iframe|video)(.|\\s)*?\\/(script|iframe|video)>/g, '') + '</div>';\r\n\t\t\t\tcleanHTML += '<div class=\"savedCommentFooter\"><ul class=\"flat-list buttons\"><li><a class=\"unsaveComment\" href=\"javascript:void 0\">unsave-RES</a></li><li><a href=\"' + escapeHTML(storedComments[i].href) + '\">view original</a></li></ul></div>';\r\n\t\t\t\t$(thisComment).html(cleanHTML);\r\n\t\t\t\tvar unsaveLink = thisComment.querySelector('.unsaveComment');\r\n\t\t\t\t$(unsaveLink)\r\n\t\t\t\t\t.data('unsaveID', i)\r\n\t\t\t\t\t.data('unsaveLink', storedComments[i].href);\r\n\t\t\t\tunsaveLink.addEventListener('click', function(e) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\tunsaveComment($(this).data('unsaveID'));\r\n\t\t\t\t}, true);\r\n\t\t\t\tsavedCommentsContent.appendChild(thisComment);\r\n\t\t\t\tsavedCommentsContent.appendChild(clearLeft);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!Object.getOwnPropertyNames(storedComments).length) {\r\n\t\t\tvar blurb = $('\t\\\r\n\t\t\t\t<li class=\"savedComment entry\">\t\\\r\n\t\t\t\t\t<p>Click the <em>save-RES</em> button on a comment, then come here to see it.</p>\t\\\r\n\t\t\t\t\t<hr>\t\\\r\n\t\t\t\t\t<p>' + module.description + '</p>\t\\\r\n\t\t\t\t</li>\t\\\r\n\t\t\t\t');\r\n\r\n\t\t\t$(savedCommentsContent).append(blurb);\r\n\r\n\t\t}\r\n\t\tRESUtils.insertAfter(savedLinksContent, savedCommentsContent);\r\n\t}\r\n\r\n\tfunction unsaveComment(id, unsaveLink) {\r\n\t\tdelete storedComments[id];\r\n\t\tRESStorage.setItem('RESmodules.saveComments.savedComments', JSON.stringify(storedComments));\r\n\t\tif (typeof savedCommentsContent !== 'undefined') {\r\n\t\t\tsavedCommentsContent.parentNode.removeChild(savedCommentsContent);\r\n\t\t\tdrawSavedComments();\r\n\t\t\tshowSavedTab('comments');\r\n\t\t} else {\r\n\t\t\tvar commentObj = unsaveLink.parentNode.parentNode;\r\n\t\t\tunsaveLink.parentNode.removeChild(unsaveLink);\r\n\t\t\taddSaveLinkToComment(commentObj);\r\n\t\t}\r\n\t}\r\n\r\n\tmodule.showEducationalNotification = function() {\r\n\t\tmodules['notifications'].showNotification({\r\n\t\t\tmoduleID: moduleID,\r\n\t\t\toptionKey: 'savePost',\r\n\t\t\tnotificationID: 'saveRES-educational',\r\n\t\t\tcloseDelay: 10000,\r\n\t\t\tcooldown: 3 * 7 * 24 * 60 * 60 * 1000,\r\n\t\t\theader: 'Saving Posts and Comments',\r\n\t\t\tmessage: '<p>The keyboard shortcuts <b>\"' + modules['keyboardNav'].getNiceKeyCode('savePost') + '\"</b> (posts) and <b>\"' + modules['keyboardNav'].getNiceKeyCode('saveComment') + '\"</b> (comments) will save a post/comment to your reddit account (same as the \"save\" button). It will be accessible from anywhere that you\\'re logged in, but the original text will not be preserved if it is edited or deleted.</p>' +\r\n\t\t\t\t'<p>The keyboard shortcut <b>\"' + modules['keyboardNav'].getNiceKeyCode('saveRES') + '\"</b> will save a comment to RES (same as the \"save-RES\" button). It will only be available locally, but the original text will be preserved if the comment is edited or deleted.</p>' +\r\n\t\t\t\t'<p>These shortcuts can be changed in the ' + modules['settingsNavigation'].makeUrlHashLink('keyboardNav', 'savePost', 'settings console') + '.<p>'\r\n\t\t});\r\n\t};\r\n});\r\n"],"sourceRoot":"/source/"}